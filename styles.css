:root {
    --primary: #2563eb;
    --primary-dark: #1e40af;
    --accent: #38bdf8;
    --background: #f8fafc;
    --surface: #fff;
    --border: #e0e7ef;
    --text: #22223b;
    --muted: #64748b;
    --shadow: 0 4px 24px rgba(30, 64, 175, 0.08), 0 1.5px 4px rgba(30, 64, 175, 0.06);
    --radius: 14px;
}

body { font-family: 'Segoe UI', 'Arial', sans-serif; margin: 0; padding: 0; background: var(--background); color: var(--text); min-height: 100vh; }
.container { max-width: 1100px; margin: 40px auto 0 auto; background: var(--surface); border-radius: var(--radius); box-shadow: var(--shadow); padding: 36px 32px 32px 32px; position: relative; }
h1 { color: var(--primary); font-size: 2.2rem; margin-bottom: 8px; letter-spacing: -1px; }
p { color: var(--muted); margin-bottom: 28px; font-size: 1.08rem; }
.controls { margin: 24px 0 18px 0; display: flex; gap: 18px; flex-wrap: wrap; justify-content: center; align-items: center; }
input[type="file"], select { padding: 7px 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--background); color: var(--text); font-size: 1rem; outline: none; }
input[type="file"]:focus, select:focus { border: 1.5px solid var(--primary); }
button { padding: 10px 28px; background: var(--primary); color: #fff; border: none; border-radius: 8px; font-size: 1rem; font-weight: 500; box-shadow: 0 2px 8px rgba(37,99,235,0.07); cursor: pointer; transition: background 0.18s, box-shadow 0.18s; }
button:hover, button:focus { background: var(--primary-dark); box-shadow: 0 4px 16px rgba(37,99,235,0.13); }
#error { color: #e11d48; margin-top: 8px; font-size: 1.05rem; min-height: 24px; text-align: center; }
canvas { border: 1.5px solid var(--border); background: var(--surface); border-radius: 0; box-shadow: 0 2px 12px rgba(30, 64, 175, 0.07); max-width: 100%; margin-top: 18px; margin-bottom: 18px; display: block; }
#infoBox { position: absolute; background: #fff; color: var(--text); padding: 18px 22px 14px 22px; border-radius: 12px; font-size: 1.04rem; line-height: 1.6; pointer-events: none; z-index: 1000; display: none; box-shadow: 0 8px 32px rgba(37,99,235,0.13), 0 2px 8px rgba(30, 64, 175, 0.09); min-width: 220px; border: 1.5px solid var(--border); transition: box-shadow 0.18s; }
#infoBox .info-title { font-weight: 600; color: var(--primary); margin-bottom: 10px; font-size: 1.08rem; letter-spacing: 0.2px; }
#infoBox .info-item { margin: 4px 0; display: flex; gap: 8px; }
#infoBox .info-label { color: var(--primary-dark); font-weight: 500; min-width: 80px; display: inline-block; }
#infoBox .info-value { color: var(--muted); font-weight: 400; }
.stats { margin-top: 28px; padding: 22px 28px 18px 28px; background: var(--surface); border-radius: var(--radius); box-shadow: 0 2px 12px rgba(30, 64, 175, 0.07); border: 1.5px solid var(--border); text-align: left; display: none; }
.toggle { display: inline-flex; align-items: center; gap: 10px; user-select: none; }
.switch { position: relative; width: 64px; height: 32px; background: var(--border); border-radius: 999px; cursor: pointer; transition: background 0.2s; }
.switch::after { content: ''; position: absolute; top: 3px; left: 3px; width: 26px; height: 26px; background: #fff; border-radius: 50%; box-shadow: 0 1px 4px rgba(0,0,0,0.15); transition: transform 0.2s; }
.switch.on { background: var(--primary); }
.switch.on::after { transform: translateX(32px); }

.thumb-grid { margin-top: 18px; display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 16px; }
.thumb-item { perspective: 1000px; }
.thumb-card { position: relative; width: 100%; height: 230px; transform-style: preserve-3d; transition: transform 0.5s ease; cursor: pointer; }
.thumb-card.is-flipped { transform: rotateY(180deg); }
.thumb-face { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; border: 1px solid var(--border); border-radius: 0; padding: 10px; background: var(--surface); box-shadow: 0 1px 6px rgba(30, 64, 175, 0.06); backface-visibility: hidden; overflow: hidden; }
.thumb-front canvas { width: auto; height: 150px; margin: 0 auto; display: block; border-radius: 0; border: 1px dashed var(--primary); background: #fff; }
.thumb-caption { margin-top: 8px; font-size: 0.9rem; color: var(--text); text-align: center; word-break: break-word; font-weight: 600; line-height: 1.2; max-height: 2.4em; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
.thumb-back { transform: rotateY(180deg); align-items: flex-start; gap: 6px; padding: 10px 12px; overflow: auto; }
.kv { display: flex; gap: 8px; font-size: 0.85rem; color: var(--muted); width: 100%; line-height: 1.2; word-break: break-word; }
.kv .k { color: var(--primary-dark); min-width: 78px; font-weight: 600; }
.kv .v { color: var(--muted); }

/* Canvas stack for multiple images */
#canvasStack { display: none; margin-top: 12px; }
.canvas-block { margin-bottom: 24px; }
.canvas-title { font-weight: 600; color: var(--primary-dark); margin: 6px 0 0 0; font-size: 0.95rem; }

/* Modal styles */
.modal-overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.5); display: flex; align-items: center; justify-content: center; z-index: 2000; padding: 24px; opacity: 0; pointer-events: none; transition: opacity 0.28s ease; }
.modal-overlay.open { opacity: 1; pointer-events: auto; }
.modal-content { position: relative; background: var(--surface); border-radius: 14px; box-shadow: var(--shadow); border: 1px solid var(--border); max-width: min(1000px, 92vw); max-height: min(86vh, 900px); width: 92vw; overflow: hidden; display: flex; flex-direction: column; transform: perspective(1000px) rotateY(-14deg) translateY(10px) scale(0.96); transform-origin: center; opacity: 0; transition: transform 0.45s cubic-bezier(0.2, 0.7, 0.2, 1), opacity 0.3s ease; }
.modal-overlay.open .modal-content { transform: perspective(1000px) rotateY(0deg) translateY(0) scale(1); opacity: 1; }
.modal-close { position: absolute; top: 10px; right: 10px; background: transparent; border: none; font-size: 28px; color: var(--muted); cursor: pointer; line-height: 1; padding: 6px; }
.modal-download { width: 100%; margin-top: 16px; padding: 10px 20px; background: var(--primary); color: #fff; border: none; border-radius: 8px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: background 0.2s; }
.modal-download:hover { background: var(--primary-dark); }
.modal-body { display: grid; grid-template-columns: 1fr 320px; gap: 16px; padding: 20px; height: 100%; box-sizing: border-box; }
.modal-canvas-wrap { display: flex; align-items: center; justify-content: center; background: #fff; border: 1px dashed var(--border); border-radius: 8px; min-height: 240px; }
#modalCanvas { max-width: 100%; max-height: 100%; display: block; }
.modal-details { overflow: auto; padding: 6px; border-left: 1px solid var(--border); }
.modal-details .title { font-weight: 700; color: var(--primary); margin-bottom: 10px; }
.modal-details .kv { margin-bottom: 6px; }
@media (max-width: 860px) {
    .modal-body { grid-template-columns: 1fr; }
    .modal-details { border-left: none; border-top: 1px solid var(--border); }
}